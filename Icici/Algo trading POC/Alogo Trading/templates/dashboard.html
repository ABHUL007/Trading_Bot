<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIFTY Real-Time Trading Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background-color: #0f1419;
            color: #e7e9ea;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .card {
            background-color: #192734;
            border: 1px solid #38444d;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: #253341;
            border-bottom: 2px solid #38444d;
            font-weight: bold;
            padding: 15px;
        }
        
        .price-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }
        
        .price-up {
            color: #00c853 !important;
        }
        
        .price-down {
            color: #ff1744 !important;
        }
        
        .trade-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .trade-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        
        .trade-card.bullish {
            border-left-color: #00c853;
        }
        
        .trade-card.bearish {
            border-left-color: #ff1744;
        }
        
        .btn-buy {
            background: linear-gradient(135deg, #00c853 0%, #00e676 100%);
            border: none;
            color: white;
            font-weight: bold;
        }
        
        .btn-buy:hover {
            background: linear-gradient(135deg, #00e676 0%, #00c853 100%);
            color: white;
        }
        
        .btn-sell {
            background: linear-gradient(135deg, #ff1744 0%, #ff5252 100%);
            border: none;
            color: white;
            font-weight: bold;
        }
        
        .btn-sell:hover {
            background: linear-gradient(135deg, #ff5252 0%, #ff1744 100%);
            color: white;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: #00c853;
            box-shadow: 0 0 10px #00c853;
        }
        
        .status-inactive {
            background-color: #ff1744;
            box-shadow: 0 0 10px #ff1744;
        }
        
        .alert-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            padding: 20px;
        }
        
        .probability-badge {
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .prob-high {
            background-color: #00c853;
            color: white;
        }
        
        .prob-medium {
            background-color: #ffa726;
            color: white;
        }
        
        .prob-low {
            background-color: #ff1744;
            color: white;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
        }
        
        .session-form {
            background-color: #253341;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line"></i> NIFTY Trading Dashboard
            </a>
            <div class="d-flex align-items-center">
                <span class="me-3">
                    <span class="status-indicator" id="sessionStatus"></span>
                    <span id="sessionText">Disconnected</span>
                </span>
                <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#sessionModal">
                    <i class="fas fa-key"></i> Update Session
                </button>
            </div>
        </div>
    </nav>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Column - Price & Chart -->
            <div class="col-lg-7">
                <!-- Current Price -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-rupee-sign"></i> NIFTY 50 - Live Price
                    </div>
                    <div class="card-body">
                        <div class="price-display" id="currentPrice">
                            â‚¹ --,---
                        </div>
                        <div class="text-center mt-2">
                            <small class="text-muted">Last Update: <span id="lastUpdate">--:--:--</span></small>
                        </div>
                    </div>
                </div>

                <!-- Live Chart -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-candlestick"></i> Live Candlestick Chart (1-Min)
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Trading Signals -->
            <div class="col-lg-5">
                <!-- Tomorrow's Market Outlook -->
                <div class="card" id="tomorrowOutlook" style="display:none;">
                    <div class="card-header">
                        <i class="fas fa-crystal-ball"></i> Tomorrow's Market Outlook
                    </div>
                    <div class="card-body">
                        <div class="row text-center mb-3">
                            <div class="col-4">
                                <h5 id="rsi15m">--</h5>
                                <small class="text-muted">RSI 15m</small>
                            </div>
                            <div class="col-4">
                                <h5 id="rsi1h">--</h5>
                                <small class="text-muted">RSI 1h</small>
                            </div>
                            <div class="col-4">
                                <h5 id="rsiDaily">--</h5>
                                <small class="text-muted">RSI Daily</small>
                            </div>
                        </div>
                        <div class="alert" id="marketBias" role="alert">
                            <strong id="biasText">Loading...</strong>
                        </div>
                        <div id="topScenarios"></div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-info-circle"></i> System Status
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <h5 id="statusPrice">â‚¹0</h5>
                                <small class="text-muted">Current Price</small>
                            </div>
                            <div class="col-4">
                                <h5 id="statusTrades">0</h5>
                                <small class="text-muted">Active Signals</small>
                            </div>
                            <div class="col-4">
                                <h5 id="statusSession">
                                    <i class="fas fa-times-circle text-danger"></i>
                                </h5>
                                <small class="text-muted">Session</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Best Trading Signals -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-fire"></i> Best Trading Opportunities
                        <button class="btn btn-sm btn-outline-light float-end" onclick="loadTrades()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body" id="tradesContainer" style="max-height: 600px; overflow-y: auto;">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading trading signals...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Modal -->
    <div class="modal fade" id="sessionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-key"></i> Update ICICI Breeze Session</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="sessionForm">
                        <div class="mb-3">
                            <label for="apiKey" class="form-label">API Key</label>
                            <input type="text" class="form-control" id="apiKey" 
                                   placeholder="Enter your ICICI Breeze API Key" required>
                        </div>
                        <div class="mb-3">
                            <label for="sessionToken" class="form-label">Session Token (8 characters)</label>
                            <input type="text" class="form-control" id="sessionToken" 
                                   placeholder="Enter 8-character session token" 
                                   maxlength="8" required>
                            <small class="text-muted">
                                Get from: <a href="https://api.icicidirect.com/apiuser/login?api_key=YOUR_API_KEY" 
                                target="_blank">ICICI Session Generator</a>
                            </small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateSession()">
                        <i class="fas fa-check"></i> Update & Connect
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div class="modal fade" id="orderModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title" id="orderModalTitle"><i class="fas fa-shopping-cart"></i> Confirm Order</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="orderModalBody">
                    <!-- Dynamic content -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="confirmOrderBtn">
                        <i class="fas fa-check"></i> Confirm Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let socket;
        let priceChart;
        let chartData = {
            labels: [],
            datasets: [{
                label: 'NIFTY 50',
                data: [],
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 2,
                tension: 0.4
            }]
        };
        let lastPrice = 0;
        let currentTrade = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            loadTrades();
            loadTomorrowOutlook();
            connectWebSocket();
            checkStatus();
        });

        // Initialize Chart
        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            grid: { color: '#38444d' },
                            ticks: { color: '#e7e9ea' }
                        },
                        x: {
                            grid: { color: '#38444d' },
                            ticks: { color: '#e7e9ea' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e7e9ea' }
                        }
                    }
                }
            });
        }

        // Connect WebSocket
        function connectWebSocket() {
            socket = io('/live');
            
            socket.on('connect', function() {
                console.log('WebSocket connected');
            });
            
            socket.on('price_update', function(data) {
                updatePrice(data.price, data.time);
                updateChart(data.candle);
            });
            
            socket.on('trading_alert', function(data) {
                showTradingAlert(data);
            });
            
            socket.on('disconnect', function() {
                console.log('WebSocket disconnected');
            });
        }

        // Update current price display
        function updatePrice(price, time) {
            const priceElement = document.getElementById('currentPrice');
            const formattedPrice = 'â‚¹ ' + Number(price).toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            // Add color animation
            if (price > lastPrice) {
                priceElement.classList.remove('price-down');
                priceElement.classList.add('price-up');
            } else if (price < lastPrice) {
                priceElement.classList.remove('price-up');
                priceElement.classList.add('price-down');
            }
            
            priceElement.textContent = formattedPrice;
            document.getElementById('lastUpdate').textContent = time;
            document.getElementById('statusPrice').textContent = formattedPrice;
            
            lastPrice = price;
        }

        // Update chart
        function updateChart(candle) {
            // Keep last 60 data points (1 hour if 1-min candles)
            if (chartData.labels.length > 60) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
            }
            
            chartData.labels.push(candle.time);
            chartData.datasets[0].data.push(candle.close);
            
            priceChart.update('none'); // Update without animation for smoother real-time
        }

        // Load trading signals
        async function loadTrades() {
            try {
                const response = await fetch('/api/trades');
                const data = await response.json();
                
                if (data.success) {
                    displayTrades(data.trades);
                    document.getElementById('statusTrades').textContent = data.trades.length;
                    
                    // Also display summary if available
                    if (data.summary) {
                        displaySummary(data.summary);
                    }
                }
            } catch (error) {
                console.error('Error loading trades:', error);
                showAlert('Error loading trades', 'danger');
            }
        }

        // Load tomorrow's market outlook
        async function loadTomorrowOutlook() {
            try {
                const response = await fetch('/api/tomorrow');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    const summary = data.summary;
                    
                    // Show the outlook card
                    document.getElementById('tomorrowOutlook').style.display = 'block';
                    
                    // Update RSI values
                    const rsi = summary.rsi;
                    document.getElementById('rsi15m').textContent = rsi['15m'].toFixed(2);
                    document.getElementById('rsi1h').textContent = rsi['1h'].toFixed(2);
                    document.getElementById('rsiDaily').textContent = rsi['daily'].toFixed(2);
                    
                    // Update market bias
                    const biasAlert = document.getElementById('marketBias');
                    biasAlert.className = `alert alert-${summary.bias_color}`;
                    document.getElementById('biasText').textContent = `Market Bias: ${summary.market_bias}`;
                    
                    // Show top scenarios
                    let scenariosHtml = '<h6 class="mt-3">Top Scenarios:</h6>';
                    
                    if (summary.best_bullish_scenarios && summary.best_bullish_scenarios.length > 0) {
                        scenariosHtml += '<div class="mb-2"><strong class="text-success">ðŸ“ˆ If Market Goes UP:</strong>';
                        summary.best_bullish_scenarios.slice(0, 2).forEach(s => {
                            scenariosHtml += `<div class="small mt-1">â€¢ ${s.type} at â‚¹${s.level.toFixed(2)} (${s.probability_10pts.toFixed(0)}%)</div>`;
                        });
                        scenariosHtml += '</div>';
                    }
                    
                    if (summary.best_bearish_scenarios && summary.best_bearish_scenarios.length > 0) {
                        scenariosHtml += '<div class="mb-2"><strong class="text-danger">ðŸ“‰ If Market Goes DOWN:</strong>';
                        summary.best_bearish_scenarios.slice(0, 2).forEach(s => {
                            scenariosHtml += `<div class="small mt-1">â€¢ ${s.type} at â‚¹${s.level.toFixed(2)} (${s.probability_10pts.toFixed(0)}%)</div>`;
                        });
                        scenariosHtml += '</div>';
                    }
                    
                    document.getElementById('topScenarios').innerHTML = scenariosHtml;
                }
            } catch (error) {
                console.error('Tomorrow outlook not available:', error);
                document.getElementById('tomorrowOutlook').style.display = 'none';
            }
        }

        function displaySummary(summary) {
            // Additional summary display if needed
            console.log('Market Summary:', summary);
        }

        // Display trades
        function displayTrades(trades) {
            const container = document.getElementById('tradesContainer');
            
            if (trades.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">No trading signals available</p>';
                return;
            }
            
            let html = '';
            trades.forEach((trade, index) => {
                const directionClass = trade.direction === 'BULLISH' ? 'bullish' : 'bearish';
                const directionIcon = trade.direction === 'BULLISH' ? 'fa-arrow-up' : 'fa-arrow-down';
                const probClass = trade.probability_10pts >= 90 ? 'prob-high' : 
                                 trade.probability_10pts >= 80 ? 'prob-medium' : 'prob-low';
                
                html += `
                    <div class="trade-card ${directionClass}" onclick="showOrderModal(${index})">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="mb-1">
                                    <i class="fas ${directionIcon}"></i> ${trade.type} - ${trade.timeframe}
                                </h6>
                                <small class="text-muted">Entry: â‚¹${trade.level.toFixed(2)}</small>
                            </div>
                            <span class="probability-badge ${probClass}">
                                ${trade.probability_10pts.toFixed(1)}%
                            </span>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <small class="text-muted">Target</small>
                                <div><strong>â‚¹${trade.target_conservative.toFixed(2)}</strong></div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Stop Loss</small>
                                <div><strong>â‚¹${trade.stop_loss.toFixed(2)}</strong></div>
                            </div>
                        </div>
                        
                        <div class="mt-2">
                            <small class="text-muted">Expected Value: <strong class="text-success">+${trade.expected_value.toFixed(2)} pts</strong></small>
                            ${trade.distance_pts !== undefined ? 
                                `<br><small class="text-muted">Distance: <strong>${Math.abs(trade.distance_pts).toFixed(2)} pts (${Math.abs(trade.distance_pct).toFixed(2)}%)</strong></small>` 
                                : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Store trades globally
            window.tradesData = trades;
        }

        // Show order modal
        function showOrderModal(index) {
            const trade = window.tradesData[index];
            currentTrade = trade;
            
            const modalBody = document.getElementById('orderModalBody');
            const isBuy = trade.direction === 'BULLISH';
            
            modalBody.innerHTML = `
                <div class="alert alert-${isBuy ? 'success' : 'danger'}">
                    <h5><i class="fas fa-${isBuy ? 'arrow-up' : 'arrow-down'}"></i> ${trade.type} - ${trade.direction}</h5>
                </div>
                
                <table class="table table-dark">
                    <tr>
                        <td>Entry Level</td>
                        <td><strong>â‚¹${trade.level.toFixed(2)}</strong></td>
                    </tr>
                    <tr>
                        <td>Timeframe</td>
                        <td><strong>${trade.timeframe}</strong></td>
                    </tr>
                    <tr>
                        <td>Target (Conservative)</td>
                        <td><strong class="text-success">â‚¹${trade.target_conservative.toFixed(2)}</strong></td>
                    </tr>
                    <tr>
                        <td>Target (Aggressive)</td>
                        <td><strong class="text-success">â‚¹${trade.target_aggressive.toFixed(2)}</strong></td>
                    </tr>
                    <tr>
                        <td>Stop Loss</td>
                        <td><strong class="text-danger">â‚¹${trade.stop_loss.toFixed(2)}</strong></td>
                    </tr>
                    <tr>
                        <td>Success Probability</td>
                        <td><strong>${trade.probability_10pts.toFixed(1)}%</strong></td>
                    </tr>
                    <tr>
                        <td>Expected Value</td>
                        <td><strong class="text-success">+${trade.expected_value.toFixed(2)} pts</strong></td>
                    </tr>
                </table>
                
                <div class="mb-3">
                    <label class="form-label">Quantity (Lots)</label>
                    <input type="number" class="form-control" id="orderQuantity" value="1" min="1" max="10">
                    <small class="text-muted">1 lot = 50 NIFTY units</small>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('orderModal'));
            modal.show();
            
            // Update confirm button
            const confirmBtn = document.getElementById('confirmOrderBtn');
            confirmBtn.className = isBuy ? 'btn btn-success' : 'btn btn-danger';
            confirmBtn.innerHTML = `<i class="fas fa-check"></i> Place ${isBuy ? 'BUY' : 'SELL'} Order`;
            confirmBtn.onclick = placeOrder;
        }

        // Place order
        async function placeOrder() {
            if (!currentTrade) return;
            
            const quantity = parseInt(document.getElementById('orderQuantity').value) * 50;
            const orderType = currentTrade.direction === 'BULLISH' ? 'buy' : 'sell';
            
            try {
                const response = await fetch('/api/order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        order_type: orderType,
                        quantity: quantity,
                        price: currentTrade.entry,
                        stop_loss: currentTrade.stop_loss,
                        target: currentTrade.target_conservative
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert(`${orderType.toUpperCase()} order placed successfully! Order ID: ${data.order_id}`, 'success');
                    bootstrap.Modal.getInstance(document.getElementById('orderModal')).hide();
                } else {
                    showAlert('Order failed: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error placing order: ' + error.message, 'danger');
            }
        }

        // Update session
        async function updateSession() {
            const apiKey = document.getElementById('apiKey').value;
            const sessionToken = document.getElementById('sessionToken').value;
            
            if (!apiKey || !sessionToken || sessionToken.length !== 8) {
                showAlert('Please provide valid API Key and 8-character Session Token', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_key: apiKey,
                        session_token: sessionToken
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert(data.message, 'success');
                    bootstrap.Modal.getInstance(document.getElementById('sessionModal')).hide();
                    updateSessionStatus(true);
                } else {
                    showAlert('Session update failed: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error updating session: ' + error.message, 'danger');
            }
        }

        // Check system status
        async function checkStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                if (data.success) {
                    updateSessionStatus(data.session_active);
                }
            } catch (error) {
                console.error('Error checking status:', error);
            }
            
            // Check again in 10 seconds
            setTimeout(checkStatus, 10000);
        }

        // Update session status indicator
        function updateSessionStatus(isActive) {
            const indicator = document.getElementById('sessionStatus');
            const text = document.getElementById('sessionText');
            const statusIcon = document.getElementById('statusSession');
            
            if (isActive) {
                indicator.className = 'status-indicator status-active';
                text.textContent = 'Connected';
                statusIcon.innerHTML = '<i class="fas fa-check-circle text-success"></i>';
            } else {
                indicator.className = 'status-indicator status-inactive';
                text.textContent = 'Disconnected';
                statusIcon.innerHTML = '<i class="fas fa-times-circle text-danger"></i>';
            }
        }

        // Show trading alert
        function showTradingAlert(data) {
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWm98OScTgwOUKvl7bVmHAU7k9rwz3krBSh+yvHajzsKF2K36O2nWBMJSKHh8bllHgU2jdXvzXgpBSt+yO/XizcLGGS87+qdTgwOUKzl7bVmHAU7k9rwz3krBSh+yvHajzsKF2K36O2nWBMJSKHh8bllHgU2jdXvzXgpBSt+yO/XizcLGGS87+qdTgwOUKzl7bVmHAU7k9rwz3krBSh+yvHajzsKF2K36O2nWBMJSKHh8bllHgU2jdXvzXgpBSt+yO/XizcLGGS87+qdTgwOUKzl7bVmHAU7k9rwz3krBSh+yvHajzsKF2K36O2nWBMJSKHh8bllHgU2jdXvzXgpBSt+yO/XizcLGGS87+qdTg==');
            audio.play().catch(e => console.log('Audio play failed:', e));
            
            const alert = `
                <div class="alert alert-${data.direction === 'BULLISH' ? 'success' : 'danger'} alert-notification alert-dismissible fade show">
                    <h5><i class="fas fa-bell"></i> Trading Alert!</h5>
                    <strong>${data.type}</strong> signal at â‚¹${data.level.toFixed(2)}<br>
                    Current: â‚¹${data.current_price.toFixed(2)}<br>
                    Probability: <strong>${data.probability.toFixed(1)}%</strong><br>
                    Expected Value: <strong>+${data.expected_value.toFixed(2)} pts</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            const container = document.getElementById('alertContainer');
            container.innerHTML = alert;
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                const alertElement = container.querySelector('.alert');
                if (alertElement) {
                    alertElement.classList.remove('show');
                    setTimeout(() => alertElement.remove(), 300);
                }
            }, 10000);
        }

        // Show general alert
        function showAlert(message, type) {
            const alert = `
                <div class="alert alert-${type} alert-notification alert-dismissible fade show">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            const container = document.getElementById('alertContainer');
            container.innerHTML = alert;
            
            setTimeout(() => {
                const alertElement = container.querySelector('.alert');
                if (alertElement) {
                    alertElement.classList.remove('show');
                    setTimeout(() => alertElement.remove(), 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>
