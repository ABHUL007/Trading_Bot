<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Advanced NIFTY ML Trading Dashboard - ICICI Breeze</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .connection-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
        }
        
        .connected { background: #00ff88; color: #000; }
        .disconnected { background: #ff4444; color: #fff; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-align: center;
        }
        
        .price-card {
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
        }
        
        .current-price {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .price-change {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #ffaa00; }
        
        .ml-insights {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 200, 100, 0.15));
        }
        
        .insight-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .insight-item:last-child {
            border-bottom: none;
        }
        
        .trading-signals {
            background: linear-gradient(135deg, rgba(255, 100, 100, 0.15), rgba(255, 50, 50, 0.15));
        }
        
        .signal-class {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
        }
        
        .signal-strong { background: #00ff88; color: #000; }
        .signal-moderate { background: #ffaa00; color: #000; }
        .signal-weak { background: #ff8800; color: #fff; }
        .signal-no { background: #ff4444; color: #fff; }
        
        .levels-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .levels-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .levels-card h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.4rem;
            text-align: center;
        }
        
        .level-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        
        .level-item:hover {
            transform: translateX(5px);
        }
        
        .resistance-item {
            border-left: 4px solid #ff4444;
        }
        
        .support-item {
            border-left: 4px solid #00ff88;
        }
        
        .level-price {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .level-details {
            text-align: right;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .confidence-bar {
            width: 60px;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #FFD700);
            transition: width 0.3s ease;
        }
        
        .risk-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .risk-card {
            background: linear-gradient(135deg, rgba(255, 50, 50, 0.15), rgba(200, 0, 0, 0.15));
        }
        
        .portfolio-card {
            background: linear-gradient(135deg, rgba(100, 100, 255, 0.15), rgba(50, 50, 200, 0.15));
        }
        
        .market-sentiment {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.15));
        }
        
        .sentiment-indicator {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
        }
        
        .bullish-sentiment { background: #00ff88; color: #000; }
        .bearish-sentiment { background: #ff4444; color: #fff; }
        .neutral-sentiment { background: #ffaa00; color: #000; }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .alerts-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }
        
        .alerts-section h3 {
            color: #FFD700;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .alert-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid;
            animation: fadeIn 0.5s ease;
        }
        
        .alert-critical { border-color: #ff4444; background: rgba(255, 68, 68, 0.2); }
        .alert-high { border-color: #ff8800; background: rgba(255, 136, 0, 0.2); }
        .alert-medium { border-color: #ffaa00; background: rgba(255, 170, 0, 0.2); }
        .alert-info { border-color: #00ff88; background: rgba(0, 255, 136, 0.2); }
        
        .timestamp {
            text-align: center;
            margin-top: 20px;
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-indicator {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-active { background: #00ff88; color: #000; }
        .status-error { background: #ff4444; color: #fff; }
        .status-initializing { background: #ffaa00; color: #000; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loading {
            animation: pulse 2s infinite;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .levels-section {
                grid-template-columns: 1fr;
            }
            
            .risk-section {
                grid-template-columns: 1fr;
            }
            
            .current-price {
                font-size: 2.2rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Advanced NIFTY ML Trading Dashboard</h1>
            <p>Real-time ICICI Breeze WebSocket with Advanced Machine Learning & Risk Management</p>
            <div id="connectionStatus" class="connection-status disconnected">
                üî¥ Connecting...
            </div>
        </div>

        <div class="status-indicators">
            <div id="mlEngineStatus" class="status-indicator status-initializing">ü§ñ ML Engine: Initializing</div>
            <div id="riskEngineStatus" class="status-indicator status-initializing">üõ°Ô∏è Risk Engine: Initializing</div>
            <div id="tickCounter" class="status-indicator status-active">üìä Ticks: 0</div>
        </div>

        <div class="dashboard-grid">
            <div class="price-card card">
                <h3>üí∞ Current Price</h3>
                <div class="current-price" id="currentPrice">‚Çπ0.00</div>
                <div class="price-change" id="priceChange">+0.00 (0.00%)</div>
                <div id="trend">Trend: Sideways</div>
                <div id="momentum">Momentum: 0.00%</div>
            </div>

            <div class="ml-insights card">
                <h3>ü§ñ Advanced ML Insights</h3>
                <div class="insight-item">
                    <span>Direction Prediction:</span>
                    <span id="mlDirection">Analyzing...</span>
                </div>
                <div class="insight-item">
                    <span>Confidence:</span>
                    <span id="mlConfidence">0%</span>
                </div>
                <div class="insight-item">
                    <span>Technical Score:</span>
                    <span id="technicalScore">0.0</span>
                </div>
                <div class="insight-item">
                    <span>Nearest Resistance:</span>
                    <span id="nearestResistance">‚Çπ-</span>
                </div>
                <div class="insight-item">
                    <span>Nearest Support:</span>
                    <span id="nearestSupport">‚Çπ-</span>
                </div>
            </div>

            <div class="trading-signals card">
                <h3>üéØ Trading Signals</h3>
                <div class="signal-class" id="signalClass">NO SIGNAL</div>
                <div class="insight-item">
                    <span>Signal Strength:</span>
                    <span id="signalStrength">0</span>
                </div>
                <div class="insight-item">
                    <span>Action:</span>
                    <span id="signalAction">WAIT</span>
                </div>
                <div class="insight-item">
                    <span>Components:</span>
                    <span id="signalComponents">0</span>
                </div>
            </div>
        </div>

        <div class="risk-section">
            <div class="risk-card card">
                <h3>üõ°Ô∏è Risk Metrics</h3>
                <div class="insight-item">
                    <span>VaR (95%):</span>
                    <span id="varDaily">--%</span>
                </div>
                <div class="insight-item">
                    <span>Sharpe Ratio:</span>
                    <span id="sharpeRatio">--</span>
                </div>
                <div class="insight-item">
                    <span>Max Drawdown:</span>
                    <span id="maxDrawdown">--%</span>
                </div>
                <div class="insight-item">
                    <span>Current Drawdown:</span>
                    <span id="currentDrawdown">--%</span>
                </div>
                <div class="insight-item">
                    <span>Volatility:</span>
                    <span id="volatility">--%</span>
                </div>
            </div>

            <div class="portfolio-card card">
                <h3>üìä Portfolio Metrics</h3>
                <div class="insight-item">
                    <span>Total Value:</span>
                    <span id="portfolioValue">‚Çπ--</span>
                </div>
                <div class="insight-item">
                    <span>Total P&L:</span>
                    <span id="portfolioPnL">‚Çπ--</span>
                </div>
                <div class="insight-item">
                    <span>Portfolio Return:</span>
                    <span id="portfolioReturn">--%</span>
                </div>
                <div class="insight-item">
                    <span>Positions:</span>
                    <span id="numPositions">0</span>
                </div>
                <div class="insight-item">
                    <span>Avg Position Size:</span>
                    <span id="avgPositionSize">‚Çπ--</span>
                </div>
            </div>

            <div class="market-sentiment card">
                <h3>üìà Market Sentiment</h3>
                <div class="sentiment-indicator" id="sentimentIndicator">Analyzing...</div>
                <div class="insight-item">
                    <span>Sentiment Score:</span>
                    <span id="sentimentScore">0.0</span>
                </div>
                <div class="insight-item">
                    <span>Price Momentum:</span>
                    <span id="priceMomentum">0.0%</span>
                </div>
                <div class="insight-item">
                    <span>Volume Ratio:</span>
                    <span id="volumeRatio">1.0x</span>
                </div>
                <div class="insight-item">
                    <span>Confidence:</span>
                    <span id="sentimentConfidence">50%</span>
                </div>
            </div>
        </div>

        <div class="levels-section">
            <div class="levels-card">
                <h3>üöÄ Resistance Levels</h3>
                <div id="resistanceLevels">
                    <!-- Dynamic resistance levels -->
                </div>
            </div>

            <div class="levels-card">
                <h3>üõ°Ô∏è Support Levels</h3>
                <div id="supportLevels">
                    <!-- Dynamic support levels -->
                </div>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="rsiValue">--</div>
                <div class="metric-label">RSI</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="macdValue">--</div>
                <div class="metric-label">MACD</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="atrValue">--</div>
                <div class="metric-label">ATR</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="betaValue">--</div>
                <div class="metric-label">Beta</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="alphaValue">--</div>
                <div class="metric-label">Alpha</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="expectedShortfall">--</div>
                <div class="metric-label">Expected Shortfall</div>
            </div>
        </div>

        <div class="alerts-section">
            <h3>üö® Live Alerts & Risk Warnings</h3>
            <div id="alertsContainer">
                <div class="alert-item alert-info">
                    üì° Connecting to Enhanced ICICI Breeze WebSocket with ML...
                </div>
            </div>
        </div>

        <div class="timestamp" id="lastUpdate">
            Last Update: Connecting...
        </div>
    </div>

    <script>
        class AdvancedNIFTYDashboard {
            constructor() {
                this.ws = null;
                this.previousPrice = 0;
                this.alerts = [];
                this.maxAlerts = 15;
                this.connect();
            }

            connect() {
                try {
                    this.ws = new WebSocket('ws://localhost:8766');
                    
                    this.ws.onopen = () => {
                        console.log('üîó Connected to Enhanced NIFTY WebSocket');
                        this.updateConnectionStatus('connected', 'üü¢ Connected to Enhanced WebSocket');
                        this.addAlert('‚úÖ Connected to Enhanced NIFTY WebSocket server with ML & Risk Management', 'info');
                    };

                    this.ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleMessage(data);
                        } catch (error) {
                            console.error('‚ùå Error parsing WebSocket message:', error);
                        }
                    };

                    this.ws.onclose = () => {
                        console.log('üîå WebSocket connection closed');
                        this.updateConnectionStatus('disconnected', 'üî¥ Disconnected - Reconnecting...');
                        setTimeout(() => this.connect(), 3000);
                    };

                    this.ws.onerror = (error) => {
                        console.error('‚ùå WebSocket error:', error);
                        this.updateConnectionStatus('disconnected', 'üî¥ Connection Error');
                    };

                } catch (error) {
                    console.error('‚ùå Connection error:', error);
                    setTimeout(() => this.connect(), 5000);
                }
            }

            handleMessage(data) {
                switch (data.type) {
                    case 'initial_data':
                        this.updatePrice(data);
                        this.updateAdvancedML(data);
                        this.updateTradingSignals(data);
                        this.updateRiskMetrics(data);
                        this.updatePortfolioMetrics(data);
                        this.updateMarketSentiment(data);
                        this.updateLevels(data);
                        this.updateEngineStatus(data);
                        break;
                    
                    case 'price_update':
                        this.updatePrice(data);
                        this.updateAdvancedML(data);
                        this.updateTradingSignals(data);
                        this.updateRiskMetrics(data);
                        this.updatePortfolioMetrics(data);
                        this.updateMarketSentiment(data);
                        break;
                    
                    case 'risk_alerts':
                        this.handleRiskAlerts(data.data);
                        break;
                    
                    case 'position_optimization':
                        this.handlePositionOptimization(data.data);
                        break;
                }
                
                // Update tick counter
                if (data.tick_count) {
                    document.getElementById('tickCounter').textContent = `üìä Ticks: ${data.tick_count}`;
                }
            }

            updateConnectionStatus(status, message) {
                const statusElement = document.getElementById('connectionStatus');
                statusElement.textContent = message;
                statusElement.className = `connection-status ${status}`;
            }

            updatePrice(data) {
                const currentPrice = data.current_price;
                document.getElementById('currentPrice').textContent = `‚Çπ${currentPrice.toLocaleString('en-IN', {minimumFractionDigits: 2})}`;

                if (this.previousPrice > 0) {
                    const change = currentPrice - this.previousPrice;
                    const changePercent = (change / this.previousPrice) * 100;
                    const changeElement = document.getElementById('priceChange');
                    const changeText = `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%)`;
                    changeElement.textContent = changeText;
                    changeElement.className = 'price-change ' + (change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral');

                    // Check for significant moves
                    if (Math.abs(change) > 15 && this.previousPrice > 0) {
                        const direction = change > 0 ? 'üöÄ UP' : 'üìâ DOWN';
                        this.addAlert(`${direction} Significant Move: ‚Çπ${Math.abs(change).toFixed(2)} in NIFTY`, 'medium');
                    }
                }

                this.previousPrice = currentPrice;
                
                // Update basic predictions
                if (data.ml_predictions) {
                    document.getElementById('trend').textContent = `Trend: ${data.ml_predictions.trend || 'Sideways'}`;
                    document.getElementById('momentum').textContent = `Momentum: ${(data.ml_predictions.momentum || 0).toFixed(2)}%`;
                }
                
                // Update timestamp
                document.getElementById('lastUpdate').textContent = `Last Update: ${new Date(data.timestamp || data.last_update).toLocaleString()}`;
            }

            updateAdvancedML(data) {
                const predictions = data.advanced_ml_predictions || {};

                document.getElementById('mlDirection').textContent = predictions.direction || 'Analyzing...';
                document.getElementById('mlConfidence').textContent = `${(predictions.confidence * 100 || 0).toFixed(1)}%`;
                document.getElementById('technicalScore').textContent = (predictions.technical_score || 0).toFixed(3);

                // Update resistance/support info
                if (predictions.resistance_level) {
                    document.getElementById('nearestResistance').textContent = `‚Çπ${predictions.resistance_level.toFixed(2)}`;
                } else {
                    document.getElementById('nearestResistance').textContent = '‚Çπ-';
                }

                if (predictions.support_level) {
                    document.getElementById('nearestSupport').textContent = `‚Çπ${predictions.support_level.toFixed(2)}`;
                } else {
                    document.getElementById('nearestSupport').textContent = '‚Çπ-';
                }
            }

            updateTradingSignals(data) {
                const signals = data.trading_signals || {};

                const signalClass = signals.signal_class || 'NO SIGNAL';
                const signalElement = document.getElementById('signalClass');
                signalElement.textContent = signalClass;
                
                // Update signal class styling
                signalElement.className = 'signal-class';
                if (signalClass === 'STRONG') {
                    signalElement.classList.add('signal-strong');
                } else if (signalClass === 'MODERATE') {
                    signalElement.classList.add('signal-moderate');
                } else if (signalClass === 'WEAK') {
                    signalElement.classList.add('signal-weak');
                } else {
                    signalElement.classList.add('signal-no');
                }

                document.getElementById('signalStrength').textContent = signals.signal_strength || 0;
                document.getElementById('signalAction').textContent = signals.action || 'WAIT';
                document.getElementById('signalComponents').textContent = (signals.components || []).length;

                // Add trading signal alerts
                if (signals.signal_class === 'STRONG') {
                    this.addAlert(`üéØ Strong ${signals.direction} signal detected! Action: ${signals.action}`, 'info');
                }
            }

            updateRiskMetrics(data) {
                const risk = data.risk_metrics || {};

                if (risk.var) {
                    document.getElementById('varDaily').textContent = `${risk.var.historical_var || '--'}%`;
                    document.getElementById('expectedShortfall').textContent = `${risk.var.expected_shortfall || '--'}%`;
                    document.getElementById('volatility').textContent = `${risk.var.volatility || '--'}%`;
                }

                if (risk.sharpe_ratio) {
                    document.getElementById('sharpeRatio').textContent = risk.sharpe_ratio.sharpe_ratio || '--';
                }

                if (risk.max_drawdown) {
                    document.getElementById('maxDrawdown').textContent = `${risk.max_drawdown.max_drawdown || '--'}%`;
                    document.getElementById('currentDrawdown').textContent = `${risk.max_drawdown.current_drawdown || '--'}%`;
                }

                // Risk alerts
                if (risk.var && Math.abs(risk.var.historical_var) > 3) {
                    this.addAlert(`‚ö†Ô∏è High VaR detected: ${Math.abs(risk.var.historical_var).toFixed(2)}% daily risk`, 'high');
                }
            }

            updatePortfolioMetrics(data) {
                const portfolio = data.portfolio_metrics || {};

                document.getElementById('portfolioValue').textContent = `‚Çπ${(portfolio.total_value || 0).toLocaleString('en-IN')}`;
                document.getElementById('portfolioPnL').textContent = `‚Çπ${(portfolio.total_pnl || 0).toLocaleString('en-IN')}`;
                document.getElementById('portfolioReturn').textContent = `${(portfolio.portfolio_return || 0).toFixed(2)}%`;
                document.getElementById('numPositions').textContent = portfolio.num_positions || 0;
                document.getElementById('avgPositionSize').textContent = `‚Çπ${(portfolio.avg_position_size || 0).toLocaleString('en-IN')}`;

                // Portfolio alerts
                if (portfolio.portfolio_return && portfolio.portfolio_return < -5) {
                    this.addAlert(`üìâ Portfolio down ${Math.abs(portfolio.portfolio_return).toFixed(1)}%`, 'medium');
                }
            }

            updateMarketSentiment(data) {
                const sentiment = data.market_sentiment || {};

                const sentimentText = sentiment.sentiment || 'Analyzing...';
                const sentimentElement = document.getElementById('sentimentIndicator');
                sentimentElement.textContent = sentimentText;
                
                // Update sentiment styling
                sentimentElement.className = 'sentiment-indicator';
                if (sentimentText === 'Bullish') {
                    sentimentElement.classList.add('bullish-sentiment');
                } else if (sentimentText === 'Bearish') {
                    sentimentElement.classList.add('bearish-sentiment');
                } else {
                    sentimentElement.classList.add('neutral-sentiment');
                }

                document.getElementById('sentimentScore').textContent = (sentiment.score || 0).toFixed(3);
                document.getElementById('priceMomentum').textContent = `${(sentiment.price_momentum || 0).toFixed(2)}%`;
                document.getElementById('volumeRatio').textContent = `${(sentiment.volume_ratio || 1).toFixed(1)}x`;
                document.getElementById('sentimentConfidence').textContent = `${(sentiment.confidence * 100 || 50).toFixed(0)}%`;
            }

            updateLevels(data) {
                // Update resistance levels
                const resistanceContainer = document.getElementById('resistanceLevels');
                resistanceContainer.innerHTML = '';
                
                if (data.resistance_levels && data.resistance_levels.length > 0) {
                    data.resistance_levels.forEach(level => {
                        const levelElement = this.createLevelElement(level, 'resistance');
                        resistanceContainer.appendChild(levelElement);
                    });
                }

                // Update support levels
                const supportContainer = document.getElementById('supportLevels');
                supportContainer.innerHTML = '';
                
                if (data.support_levels && data.support_levels.length > 0) {
                    data.support_levels.forEach(level => {
                        const levelElement = this.createLevelElement(level, 'support');
                        supportContainer.appendChild(levelElement);
                    });
                }
            }

            createLevelElement(level, type) {
                const div = document.createElement('div');
                div.className = `level-item ${type}-item`;
                
                const strengthClass = level.strength.toLowerCase().replace(' ', '-');
                const confidence = level.ml_confidence || 0;
                
                div.innerHTML = `
                    <div>
                        <div class="level-price">‚Çπ${level.level.toLocaleString('en-IN', {minimumFractionDigits: 2})}</div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence * 100}%"></div>
                        </div>
                    </div>
                    <div class="level-details">
                        <div class="strength-badge ${strengthClass}">${level.strength}</div>
                        <div>${level.timeframe} | ${(level.hit_probability * 100).toFixed(0)}%</div>
                        <div>Hits: ${level.hits || 0}</div>
                    </div>
                `;
                
                return div;
            }

            updateEngineStatus(data) {
                const mlStatus = data.ml_engine_status || 'unknown';
                const riskStatus = data.risk_engine_status || 'unknown';

                const mlElement = document.getElementById('mlEngineStatus');
                mlElement.textContent = `ü§ñ ML Engine: ${mlStatus.charAt(0).toUpperCase() + mlStatus.slice(1)}`;
                mlElement.className = `status-indicator status-${mlStatus}`;

                const riskElement = document.getElementById('riskEngineStatus');
                riskElement.textContent = `üõ°Ô∏è Risk Engine: ${riskStatus.charAt(0).toUpperCase() + riskStatus.slice(1)}`;
                riskElement.className = `status-indicator status-${riskStatus}`;
            }

            handleRiskAlerts(alertData) {
                const alerts = alertData.alerts || [];
                alerts.forEach(alert => {
                    this.addAlert(`üõ°Ô∏è ${alert.message}`, alert.severity.toLowerCase());
                });
            }

            addAlert(message, severity = 'info') {
                const alertsContainer = document.getElementById('alertsContainer');
                
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert-item alert-${severity}`;
                alertDiv.innerHTML = `
                    <div>${message}</div>
                    <div style="font-size: 0.8rem; opacity: 0.7; margin-top: 5px;">
                        ${new Date().toLocaleTimeString()}
                    </div>
                `;
                
                // Add to beginning
                alertsContainer.insertBefore(alertDiv, alertsContainer.firstChild);
                
                // Keep only max alerts
                while (alertsContainer.children.length > this.maxAlerts) {
                    alertsContainer.removeChild(alertsContainer.lastChild);
                }
                
                // Auto-remove after 30 seconds for info alerts
                if (severity === 'info') {
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.parentNode.removeChild(alertDiv);
                        }
                    }, 30000);
                }
            }

            // Request risk alerts periodically
            requestRiskAlerts() {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        command: 'get_risk_alerts',
                        account_balance: 1000000
                    }));
                }
            }

            // Request position optimization
            requestPositionOptimization() {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        command: 'optimize_position',
                        account_balance: 1000000,
                        risk_tolerance: 2
                    }));
                }
            }
        }

        // Initialize dashboard
        const dashboard = new AdvancedNIFTYDashboard();

        // Request risk alerts every 30 seconds
        setInterval(() => {
            dashboard.requestRiskAlerts();
        }, 30000);

        // Request position optimization every 60 seconds
        setInterval(() => {
            dashboard.requestPositionOptimization();
        }, 60000);

        // Add keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey) {
                switch (event.key) {
                    case 'r':
                        event.preventDefault();
                        dashboard.requestRiskAlerts();
                        break;
                    case 'o':
                        event.preventDefault();
                        dashboard.requestPositionOptimization();
                        break;
                }
            }
        });

        console.log('üöÄ Advanced NIFTY ML Trading Dashboard initialized');
        console.log('üìä Keyboard shortcuts: Ctrl+R (Risk Alerts), Ctrl+O (Position Optimization)');
    </script>
</body>
</html>